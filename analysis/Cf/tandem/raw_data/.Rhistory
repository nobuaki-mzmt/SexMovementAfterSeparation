#sep_male_speed <- c(sep_male_speed, NA)
sep_female_speed <- c(sep_female_speed, NA)
sep_dis <- c(sep_dis, NA)
ID <- c(ID, rep(j, 1))
ID2 <- c(ID2, rep(id, 1))
ID3 <- c(ID3, rep(j, 1))
ID4 <- c(ID4, rep(id, 1))
} else {
for(i in 1:max(separate_label)){
sep_time <- c(sep_time, length(MF_dis[separate_label == i]) / anal_FPS )
#sep_male_speed <- c(sep_male_speed, mean(Male_speed[separate_label == i]) )
sep_female_speed <- c(sep_female_speed, mean(Female_speed[separate_label == i]) )
sep_dis <- c(sep_dis, mean(MF_dis[separate_label == i]) )
fem_speed_dynamics <- c(fem_speed_dynamics, list( Female_speed[separate_label == i] ) )
MF_dis_dynamics <- c(MF_dis_dynamics, list( MF_dis[separate_label == i] ) )
}
for(i in 1:max(tandem_label)){
tan_time <- c(tan_time, length(MF_dis[tandem_label == i]) / anal_FPS )
if(tandem_label[length(tandem_label)] == i){
cens <- c(cens, 0)
}else {
cens <- c(cens, 1)
}
}
for(i in 1:max(separate_label)){
if(separate_label[length(separate_label)] == i){
cens2 <- c(cens2, 0)
}else {
cens2 <- c(cens2, 1)
}
}
ID <- c(ID, rep(j, max(separate_label)))
ID2 <- c(ID2, rep(id, max(separate_label)))
ID3 <- c(ID3, rep(j, max(tandem_label)))
ID4 <- c(ID4, rep(id, max(tandem_label)))
}
print(j)
}
data.path
Folder.path
setwd("C:\\Users\\nobua\\Dropbox\\research\\with_dropbox\\papers_and_projects\\2017\\Sex movement after separation\\Cf\\tandem\\raw_data")
Folder.path <- getwd()
f.namesplace_solo <- list.files(Folder.path, pattern=".txt",full.names=T)
f.namesplace_solo
Folder.path
Folder.path <- getwd()
f.namesplace_tandem <- list.files(Folder.path, pattern=".csv",full.names=T)
f.namesplace_tandem
ID = ID2 = ID3 = ID4 = sep_time = tan_time = cens = cens2 = sep_male_speed = sep_female_speed = sep_dis <- NULL
fem_speed_dynamics = MF_dis_dynamics <- NULL
for(j in 1:length(f.namesplace_tandem)){
data.path <- f.namesplace_tandem[j]
d <- data.frame(as.matrix(fread(data.path, header=T)))
datepoint <- regexpr("170", data.path)[1]
id <- (substr(data.path, datepoint, datepoint+12))
## analyze 60 minutes data (if less than 60 minutes, use as long as possible)
d[,1] <- d[,1]/30
if(length(d[,1]) >= 30*60*60+1){
anal_time <- seq(1, 30*60*60+1, 30/anal_FPS)
} else {
anal_time <- seq(1, length(d[,1]), 30/anal_FPS)
}
## scaling
# 満遍なく移動したと想定（max - min = 145mm )
Xmin <- min(c(d$x0,d$x1)); Xmax <- max(c(d$x0,d$x1));
Ymin <- min(c(d$y0,d$y1)); Ymax <- max(c(d$y0,d$y1));
XRange <- Xmax-Xmin;
YRange <- Ymax-Ymin;
d$x0 <- (d$x0-Xmin)*145/XRange
d$x1 <- (d$x1-Xmin)*145/XRange
d$y0 <- (d$y0-Ymin)*145/YRange
d$y1 <- (d$y1-Ymin)*145/YRange
da <- d[anal_time,]
# calcurate each component
time <- da$position
Male_X <- da$x1
Male_Y <- da$y1
Female_X <- da$x0
Female_Y <- da$y0
Male_speed <- c(NA, sqrt ( diff(Male_X)^2 + diff(Male_Y)^2 ) * 5)
Female_speed <- c(NA, sqrt ( diff(Female_X)^2 + diff(Female_Y)^2 ) * 5)
L <- length(time)
# move direction (0-360 degree)
Man <- atan( (Male_Y[2:L] - Male_Y[2:L-1])/(Male_X[2:L] - Male_X[2:L-1]) )
Man[ Male_X[2:L] - Male_X[2:L-1] > 0 & !is.na(Man)] <- Man[ Male_X[2:L] - Male_X[2:L-1] > 0 & !is.na(Man)] + pi
Man[Man<0 & !is.na(Man)] <- Man[Man<0 & !is.na(Man)] + 2*pi
Man <- (Man / pi * 180)
Feman <- atan( (Female_Y[2:L] - Female_Y[2:L-1])/(Female_X[2:L] - Female_X[2:L-1]) )
Feman[ Female_X[2:L] - Female_X[2:L-1] > 0 & !is.na(Feman)] <- Feman[ Female_X[2:L] - Female_X[2:L-1] > 0 & !is.na(Feman)] + pi
Feman[Feman<0 & !is.na(Feman)] <- Feman[Feman<0 & !is.na(Feman)] + 2*pi
Feman <- (Feman / pi * 180)
MF_dis <- sqrt( (Male_X-Female_X)^2 + (Male_Y-Female_Y)^2 )
## definition of tandem running
## def1: 距離10mm以下(approximate the largest size of Cf dealates, icluding the length of antena)が
## 3sec以上続いて、初めてタンデムとみなす
## (similarlly a pair is considered to get separated when the distance >7mm for >3sec)
tandem <- MF_dis <= 10
sep_beg <- 1
for(i in 2:L){
if(!tandem[i] & tandem[i-1]){
sep_beg <- i
}
if(!tandem[i-1] & tandem[i]){
sep_en <- i-1
if(time[sep_en] - time[sep_beg] <= 3){
tandem[sep_beg:sep_en] <- TRUE
}
}
}
tan_beg <- 1
tan_en <- 1
for(i in 2:L){
if(tandem[i] & !tandem[i-1]){
tan_beg <- i
}
if(tandem[i-1] & !tandem[i]){
tan_en <- i-1
if(time[tan_en] - time[tan_beg] <= 3){
tandem[tan_en:tan_beg] <- FALSE
}
}
}
## def2: 近くにいる期間に、進んだ距離が30mm以下ならタンデムとみなさない
## (if they don't move we cannot consider that to be tandem "running")
# labeling tandem events
tandem_label <- rep(0,L)
count <- 1
for(i in 1:L){
if(tandem[i]){
tandem_label[i] <- count
} else if(i>1&&tandem[i-1]) {
count <- count + 1
}
}
for(i in 1:max(tandem_label)){
if( sum(Female_speed[tandem_label==i]/5, na.rm=T) <= 30){
tandem[tandem_label==i] <- FALSE
}
}
# separate
separate <- !tandem
for(i in 1:L){
if(!separate[i]){
separate[1:i] <- FALSE
break;
}
}
# separateイベントにラベル付け
separate_label <- rep(0,L)
count <- 1
for(i in 1:L){
if(separate[i]){
separate_label[i] <- count
} else if(i>1&&separate[i-1]) {
count <- count + 1
}
}
## def3: sep中2個体の方向の差の最大が45度以下ならsepとみなさない
## Although the distance between individuals sometimes become >7mm,
## actually they sometimes looks to perform tandem running.
for(i in 1:max(separate_label)){
an_dif <- abs(Man[separate_label==i] - Feman[separate_label==i])
rev_an_dif <- abs(360-an_dif)
an_dif[ an_dif > rev_an_dif & !is.na(an_dif)] <- rev_an_dif[ an_dif > rev_an_dif & !is.na(an_dif)]
if( max(an_dif, na.rm=T) < 45 ){
separate[separate_label==i] <- FALSE
}
}
tandem <- !separate
## 最ラベルつけ
separate_label <- rep(0,L)
count <- 1
for(i in 1:L){
if(separate[i]){
separate_label[i] <- count
} else if(i>1&&separate[i-1]) {
count <- count + 1
}
}
tandem_label <- rep(0,L)
count <- 1
for(i in 1:L){
if(tandem[i]){
tandem_label[i] <- count
} else if(i>1&&tandem[i-1]) {
count <- count + 1
}
}
## The first not separation but before encounter
if(separate[L]){
separate[separate_label==max(separate_label)] <- FALSE
}
## output
if(max(separate_label)==0){ # no separation
sep_time <- c(sep_time, 0)
tan_time <- c(tan_time, sum(tandem>0) / anal_FPS)
cens <- c(cens, 0)
cens2 <- c(cens2, 0)
#sep_male_speed <- c(sep_male_speed, NA)
sep_female_speed <- c(sep_female_speed, NA)
sep_dis <- c(sep_dis, NA)
ID <- c(ID, rep(j, 1))
ID2 <- c(ID2, rep(id, 1))
ID3 <- c(ID3, rep(j, 1))
ID4 <- c(ID4, rep(id, 1))
} else {
for(i in 1:max(separate_label)){
sep_time <- c(sep_time, length(MF_dis[separate_label == i]) / anal_FPS )
#sep_male_speed <- c(sep_male_speed, mean(Male_speed[separate_label == i]) )
sep_female_speed <- c(sep_female_speed, mean(Female_speed[separate_label == i]) )
sep_dis <- c(sep_dis, mean(MF_dis[separate_label == i]) )
fem_speed_dynamics <- c(fem_speed_dynamics, list( Female_speed[separate_label == i] ) )
MF_dis_dynamics <- c(MF_dis_dynamics, list( MF_dis[separate_label == i] ) )
}
for(i in 1:max(tandem_label)){
tan_time <- c(tan_time, length(MF_dis[tandem_label == i]) / anal_FPS )
if(tandem_label[length(tandem_label)] == i){
cens <- c(cens, 0)
}else {
cens <- c(cens, 1)
}
}
for(i in 1:max(separate_label)){
if(separate_label[length(separate_label)] == i){
cens2 <- c(cens2, 0)
}else {
cens2 <- c(cens2, 1)
}
}
ID <- c(ID, rep(j, max(separate_label)))
ID2 <- c(ID2, rep(id, max(separate_label)))
ID3 <- c(ID3, rep(j, max(tandem_label)))
ID4 <- c(ID4, rep(id, max(tandem_label)))
}
print(j)
}
j=1
data.path <- f.namesplace_tandem[j]
d <- data.frame(as.matrix(fread(data.path, header=T)))
datepoint <- regexpr("170", data.path)[1]
id <- (substr(data.path, datepoint, datepoint+12))
## analyze 60 minutes data (if less than 60 minutes, use as long as possible)
d[,1] <- d[,1]/30
if(length(d[,1]) >= 30*60*60+1){
anal_time <- seq(1, 30*60*60+1, 30/anal_FPS)
} else {
anal_time <- seq(1, length(d[,1]), 30/anal_FPS)
}
## scaling
# 満遍なく移動したと想定（max - min = 145mm )
Xmin <- min(c(d$x0,d$x1)); Xmax <- max(c(d$x0,d$x1));
Ymin <- min(c(d$y0,d$y1)); Ymax <- max(c(d$y0,d$y1));
XRange <- Xmax-Xmin;
YRange <- Ymax-Ymin;
d$x0 <- (d$x0-Xmin)*145/XRange
d$x1 <- (d$x1-Xmin)*145/XRange
d$y0 <- (d$y0-Ymin)*145/YRange
d$y1 <- (d$y1-Ymin)*145/YRange
da <- d[anal_time,]
# calcurate each component
time <- da$position
Male_X <- da$x1
Male_Y <- da$y1
Female_X <- da$x0
Female_Y <- da$y0
Male_speed <- c(NA, sqrt ( diff(Male_X)^2 + diff(Male_Y)^2 ) * 5)
Female_speed <- c(NA, sqrt ( diff(Female_X)^2 + diff(Female_Y)^2 ) * 5)
L <- length(time)
diff(Male_X)
sqrt( diff(Male_X)^2 + diff(Male_Y)^2 )
hist(sqrt( diff(Male_X)^2 + diff(Male_Y)^2 ))
truehist(sqrt( diff(Female_X)^2 + diff(Female_Y)^2 ))
truehist(sqrt( diff(Female_X)^2 + diff(Female_Y)^2 )*5)
for(j in 1:length(f.namesplace_tandem)){
data.path <- f.namesplace_tandem[j]
d <- data.frame(as.matrix(fread(data.path, header=T)))
datepoint <- regexpr("170", data.path)[1]
id <- (substr(data.path, datepoint, datepoint+12))
## analyze 60 minutes data (if less than 60 minutes, use as long as possible)
d[,1] <- d[,1]/30
if(length(d[,1]) >= 30*60*60+1){
anal_time <- seq(1, 30*60*60+1, 30/anal_FPS)
} else {
anal_time <- seq(1, length(d[,1]), 30/anal_FPS)
}
## scaling
# 満遍なく移動したと想定（max - min = 145mm )
Xmin <- min(c(d$x0,d$x1)); Xmax <- max(c(d$x0,d$x1));
Ymin <- min(c(d$y0,d$y1)); Ymax <- max(c(d$y0,d$y1));
XRange <- Xmax-Xmin;
YRange <- Ymax-Ymin;
d$x0 <- (d$x0-Xmin)*145/XRange
d$x1 <- (d$x1-Xmin)*145/XRange
d$y0 <- (d$y0-Ymin)*145/YRange
d$y1 <- (d$y1-Ymin)*145/YRange
da <- d[anal_time,]
# calcurate each component
time <- da$position
Male_X <- da$x1
Male_Y <- da$y1
Female_X <- da$x0
Female_Y <- da$y0
Male_speed <- c(NA, sqrt ( diff(Male_X)^2 + diff(Male_Y)^2 ) * 5)
Female_speed <- c(NA, sqrt ( diff(Female_X)^2 + diff(Female_Y)^2 ) * 5)
L <- length(time)
truehist(sqrt( diff(Female_X)^2 + diff(Female_Y)^2 )*5, breaks = seq(0,120,1))
}
for(j in 1:length(f.namesplace_tandem)){
data.path <- f.namesplace_tandem[j]
d <- data.frame(as.matrix(fread(data.path, header=T)))
datepoint <- regexpr("170", data.path)[1]
id <- (substr(data.path, datepoint, datepoint+12))
## analyze 60 minutes data (if less than 60 minutes, use as long as possible)
d[,1] <- d[,1]/30
if(length(d[,1]) >= 30*60*60+1){
anal_time <- seq(1, 30*60*60+1, 30/anal_FPS)
} else {
anal_time <- seq(1, length(d[,1]), 30/anal_FPS)
}
## scaling
# 満遍なく移動したと想定（max - min = 145mm )
Xmin <- min(c(d$x0,d$x1)); Xmax <- max(c(d$x0,d$x1));
Ymin <- min(c(d$y0,d$y1)); Ymax <- max(c(d$y0,d$y1));
XRange <- Xmax-Xmin;
YRange <- Ymax-Ymin;
d$x0 <- (d$x0-Xmin)*145/XRange
d$x1 <- (d$x1-Xmin)*145/XRange
d$y0 <- (d$y0-Ymin)*145/YRange
d$y1 <- (d$y1-Ymin)*145/YRange
da <- d[anal_time,]
# calcurate each component
time <- da$position
Male_X <- da$x1
Male_Y <- da$y1
Female_X <- da$x0
Female_Y <- da$y0
Male_speed <- c(NA, sqrt ( diff(Male_X)^2 + diff(Male_Y)^2 ) * 5)
Female_speed <- c(NA, sqrt ( diff(Female_X)^2 + diff(Female_Y)^2 ) * 5)
L <- length(time)
truehist(sqrt( diff(Female_X)^2 + diff(Female_Y)^2 )*5, breaks = seq(0,140,1))
}
}
for(j in 1:length(f.namesplace_tandem)){
data.path <- f.namesplace_tandem[j]
d <- data.frame(as.matrix(fread(data.path, header=T)))
datepoint <- regexpr("170", data.path)[1]
id <- (substr(data.path, datepoint, datepoint+12))
## analyze 60 minutes data (if less than 60 minutes, use as long as possible)
d[,1] <- d[,1]/30
if(length(d[,1]) >= 30*60*60+1){
anal_time <- seq(1, 30*60*60+1, 30/anal_FPS)
} else {
anal_time <- seq(1, length(d[,1]), 30/anal_FPS)
}
## scaling
# 満遍なく移動したと想定（max - min = 145mm )
Xmin <- min(c(d$x0,d$x1)); Xmax <- max(c(d$x0,d$x1));
Ymin <- min(c(d$y0,d$y1)); Ymax <- max(c(d$y0,d$y1));
XRange <- Xmax-Xmin;
YRange <- Ymax-Ymin;
d$x0 <- (d$x0-Xmin)*145/XRange
d$x1 <- (d$x1-Xmin)*145/XRange
d$y0 <- (d$y0-Ymin)*145/YRange
d$y1 <- (d$y1-Ymin)*145/YRange
da <- d[anal_time,]
# calcurate each component
time <- da$position
Male_X <- da$x1
Male_Y <- da$y1
Female_X <- da$x0
Female_Y <- da$y0
Male_speed <- c(NA, sqrt ( diff(Male_X)^2 + diff(Male_Y)^2 ) * 5)
Female_speed <- c(NA, sqrt ( diff(Female_X)^2 + diff(Female_Y)^2 ) * 5)
L <- length(time)
truehist(sqrt( diff(Female_X)^2 + diff(Female_Y)^2 )*5, breaks = seq(0,180,1))
}
for(j in 1:length(f.namesplace_tandem)){
data.path <- f.namesplace_tandem[j]
d <- data.frame(as.matrix(fread(data.path, header=T)))
datepoint <- regexpr("170", data.path)[1]
id <- (substr(data.path, datepoint, datepoint+12))
## analyze 60 minutes data (if less than 60 minutes, use as long as possible)
d[,1] <- d[,1]/30
if(length(d[,1]) >= 30*60*60+1){
anal_time <- seq(1, 30*60*60+1, 30/anal_FPS)
} else {
anal_time <- seq(1, length(d[,1]), 30/anal_FPS)
}
## scaling
# 満遍なく移動したと想定（max - min = 145mm )
Xmin <- min(c(d$x0,d$x1)); Xmax <- max(c(d$x0,d$x1));
Ymin <- min(c(d$y0,d$y1)); Ymax <- max(c(d$y0,d$y1));
XRange <- Xmax-Xmin;
YRange <- Ymax-Ymin;
d$x0 <- (d$x0-Xmin)*145/XRange
d$x1 <- (d$x1-Xmin)*145/XRange
d$y0 <- (d$y0-Ymin)*145/YRange
d$y1 <- (d$y1-Ymin)*145/YRange
da <- d[anal_time,]
# calcurate each component
time <- da$position
Male_X <- da$x1
Male_Y <- da$y1
Female_X <- da$x0
Female_Y <- da$y0
Male_speed <- c(NA, sqrt ( diff(Male_X)^2 + diff(Male_Y)^2 ) * 5)
Female_speed <- c(NA, sqrt ( diff(Female_X)^2 + diff(Female_Y)^2 ) * 5)
L <- length(time)
truehist(sqrt( diff(Female_X)^2 + diff(Female_Y)^2 )*5, breaks = seq(0,500,1). xlim=c(0,120))
}
for(j in 1:length(f.namesplace_tandem)){
data.path <- f.namesplace_tandem[j]
d <- data.frame(as.matrix(fread(data.path, header=T)))
datepoint <- regexpr("170", data.path)[1]
id <- (substr(data.path, datepoint, datepoint+12))
## analyze 60 minutes data (if less than 60 minutes, use as long as possible)
d[,1] <- d[,1]/30
if(length(d[,1]) >= 30*60*60+1){
anal_time <- seq(1, 30*60*60+1, 30/anal_FPS)
} else {
anal_time <- seq(1, length(d[,1]), 30/anal_FPS)
}
## scaling
# 満遍なく移動したと想定（max - min = 145mm )
Xmin <- min(c(d$x0,d$x1)); Xmax <- max(c(d$x0,d$x1));
Ymin <- min(c(d$y0,d$y1)); Ymax <- max(c(d$y0,d$y1));
XRange <- Xmax-Xmin;
YRange <- Ymax-Ymin;
d$x0 <- (d$x0-Xmin)*145/XRange
d$x1 <- (d$x1-Xmin)*145/XRange
d$y0 <- (d$y0-Ymin)*145/YRange
d$y1 <- (d$y1-Ymin)*145/YRange
da <- d[anal_time,]
# calcurate each component
time <- da$position
Male_X <- da$x1
Male_Y <- da$y1
Female_X <- da$x0
Female_Y <- da$y0
Male_speed <- c(NA, sqrt ( diff(Male_X)^2 + diff(Male_Y)^2 ) * 5)
Female_speed <- c(NA, sqrt ( diff(Female_X)^2 + diff(Female_Y)^2 ) * 5)
L <- length(time)
truehist(sqrt( diff(Female_X)^2 + diff(Female_Y)^2 )*5, breaks = seq(0,500,1). xlim=c(0,120))
}
for(j in 1:length(f.namesplace_tandem)){
data.path <- f.namesplace_tandem[j]
d <- data.frame(as.matrix(fread(data.path, header=T)))
datepoint <- regexpr("170", data.path)[1]
id <- (substr(data.path, datepoint, datepoint+12))
## analyze 60 minutes data (if less than 60 minutes, use as long as possible)
d[,1] <- d[,1]/30
if(length(d[,1]) >= 30*60*60+1){
anal_time <- seq(1, 30*60*60+1, 30/anal_FPS)
} else {
anal_time <- seq(1, length(d[,1]), 30/anal_FPS)
}
## scaling
# 満遍なく移動したと想定（max - min = 145mm )
Xmin <- min(c(d$x0,d$x1)); Xmax <- max(c(d$x0,d$x1));
Ymin <- min(c(d$y0,d$y1)); Ymax <- max(c(d$y0,d$y1));
XRange <- Xmax-Xmin;
YRange <- Ymax-Ymin;
d$x0 <- (d$x0-Xmin)*145/XRange
d$x1 <- (d$x1-Xmin)*145/XRange
d$y0 <- (d$y0-Ymin)*145/YRange
d$y1 <- (d$y1-Ymin)*145/YRange
da <- d[anal_time,]
# calcurate each component
time <- da$position
Male_X <- da$x1
Male_Y <- da$y1
Female_X <- da$x0
Female_Y <- da$y0
Male_speed <- c(NA, sqrt ( diff(Male_X)^2 + diff(Male_Y)^2 ) * 5)
Female_speed <- c(NA, sqrt ( diff(Female_X)^2 + diff(Female_Y)^2 ) * 5)
L <- length(time)
truehist(sqrt( diff(Female_X)^2 + diff(Female_Y)^2 )*5, breaks = seq(0,500,1). xlim=c(0,120))
}
for(j in 1:length(f.namesplace_tandem)){
data.path <- f.namesplace_tandem[j]
d <- data.frame(as.matrix(fread(data.path, header=T)))
datepoint <- regexpr("170", data.path)[1]
id <- (substr(data.path, datepoint, datepoint+12))
## analyze 60 minutes data (if less than 60 minutes, use as long as possible)
d[,1] <- d[,1]/30
if(length(d[,1]) >= 30*60*60+1){
anal_time <- seq(1, 30*60*60+1, 30/anal_FPS)
} else {
anal_time <- seq(1, length(d[,1]), 30/anal_FPS)
}
## scaling
# 満遍なく移動したと想定（max - min = 145mm )
Xmin <- min(c(d$x0,d$x1)); Xmax <- max(c(d$x0,d$x1));
Ymin <- min(c(d$y0,d$y1)); Ymax <- max(c(d$y0,d$y1));
XRange <- Xmax-Xmin;
YRange <- Ymax-Ymin;
d$x0 <- (d$x0-Xmin)*145/XRange
d$x1 <- (d$x1-Xmin)*145/XRange
d$y0 <- (d$y0-Ymin)*145/YRange
d$y1 <- (d$y1-Ymin)*145/YRange
da <- d[anal_time,]
# calcurate each component
time <- da$position
Male_X <- da$x1
Male_Y <- da$y1
Female_X <- da$x0
Female_Y <- da$y0
Male_speed <- c(NA, sqrt ( diff(Male_X)^2 + diff(Male_Y)^2 ) * 5)
Female_speed <- c(NA, sqrt ( diff(Female_X)^2 + diff(Female_Y)^2 ) * 5)
L <- length(time)
truehist(sqrt( diff(Female_X)^2 + diff(Female_Y)^2 )*5, breaks = seq(0,500,1), xlim=c(0,120))
}
