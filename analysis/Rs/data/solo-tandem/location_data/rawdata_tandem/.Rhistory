##### data を解析用に修正・保存
########################
d <- data.frame(as.matrix(fread(data.path, header=T)))
## 時間合わせ
# 30FPSのdataを変更
d[,1] <- d[,1]/30
anal_time <- seq(1, 30*30*60+1, 30/anal_FPS)
## scaling
# 満遍なく移動したと想定（max - min = 150mm）
Xmin <- min(na.omit(d$x0)); d$x0 <- d$x0 - Xmin;
Ymin <- min(na.omit(d$y0)); d$y0 <- d$y0 - Ymin;
setpoint <- regexpr("set", data.path)[1]
videoset <- as.numeric(substr(data.path, setpoint+3, setpoint+3))
if(videoset==1){
d$x0 <- d$x0 * set1X; d$y0 <- d$y0 * set1Y;
} else if(videoset==2){
d$x0 <- d$x0 * set2X; d$y0 <- d$y0 * set2Y;
} else {
d$x0 <- d$x0 * set3X; d$y0 <- d$y0 * set3Y;
}
## データ作成, 軌跡保存
da <- d[anal_time,]
L <- length(da[,1])
time <- da[,1]
x <- da[,2]
y <- da[,3]
dis <- ( (x[2:L]-x[2:L-1])^2 + (y[2:L]-y[2:L-1])^2 )^0.5
speed <- dis*5
Ax <- (x[3:L-1] - x[3:L-2])
Bx <- (x[3:L] - x[3:L-1])
Ay <- (y[3:L-1] - y[3:L-2])
By <- (y[3:L] - y[3:L-1])
hugo <- (Ax * By - Ay * Bx + 0.000001)/abs(Ax * By - Ay * Bx + 0.000001)
cos <- (Ax * Bx + Ay * By) / ((Ax^2 + Ay^2)*(Bx^2 + By^2))^0.5
angle <- acos(cos)*hugo
## save
## sex, 0:F, 1:M
datepoint <- regexpr("170", data.path)[1]
id <- (substr(data.path, datepoint, datepoint+13))
date <- (substr(data.path, datepoint, datepoint+5))
if(regexpr("_F_",data.path)>0) { sex <- 0;} else { sex <- 1; }
colony <- (substr(data.path, datepoint+7, datepoint+9))
iter <- (substr(data.path, datepoint+13, datepoint+13))
treat <- (substr(data.path, datepoint+15, datepoint+20))
if(treat=="after-"){treat <- "after"}
trajectory_name <- gsub(".csv",".pdf",data.path)
pdf(trajectory_name)
par(pin=c(2.2, 2.2), mfrow=c(2,2))
#par(pin=c(5, 5), mfrow=c(1,1))
plot(y0~x0, data=da, type="l",xlim=c(0,145), ylim=c(0,145), xlab="x (mm)", ylab="y (mm)", main=paste(id,treat))
plot(time[2:L], speed, xlab="time (sec)", ylab="speed (mm/sec)", main=paste(id,treat))
plot(time[3:L], abs(angle), xlab="time (sec)", ylab="angle (rad)", main=paste(id,treat))
dev.off()
#for(i in seq(1, length(anal_time), 10)){
#  j <- max(1,i-50)
#  plot(y0~x0, data=da[j:i,], type="l", xlim=c(0,150), ylim=c(0,150), main = paste(da[i,1], "sec"))
#  points(y0~x0, data=da[i,], pch=19)
#  Sys.sleep(0.05)
#}
## 1分ごとの平均値
mincom <- seq(1,30,1)
minutes <- c(0, rep(seq(1,30,1), each = 5*60))
mean_speed <- tapply(na.omit(speed), minutes[2:L][!is.nan(speed)&!is.na(speed)], mean)
mean_angle <- tapply(na.omit(abs(angle)), minutes[3:L][!is.nan(angle)&!is.na(angle)], mean)
if(length(mean_angle)<30){mean_angle<-c(mean_angle,rep(NA,30-length(mean_angle)))}
if(length(mean_speed)<30){mean_speed<-c(mean_speed,rep(NA,30-length(mean_speed)))}
Colony <- c(Colony, rep(colony, 30))
Sex <- c(Sex, rep(sex, 30))
ID <- c(ID, rep(paste(date,iter,sep="_"), 30))
Treat <- c(Treat, rep(treat, 30))
Minutes <- c(Minutes, mincom)
Mean_speed <- c(Mean_speed, mean_speed)
Mean_angle <- c(Mean_angle, mean_angle)
}
res <- na.omit(data.frame(colony=Colony, sex=Sex, is=ID, treat=Treat, min=Minutes,
mean_speed=Mean_speed, mean_angle=Mean_angle))
res_before <- res[res$treat=="before",]
res_after <- res[res$treat=="after",]
res_before_mean <- tapply(res_before$mean_speed, res_before[,c(5,2)], mean)
res_after_mean <- tapply(res_after$mean_speed, res_after[,c(5,2)], mean)
res_before_se <- tapply(res_before$mean_speed, res_before[,c(5,2)], se)
res_after_se <- tapply(res_after$mean_speed, res_after[,c(5,2)], se)
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,16))
arrows(mincom, res_before_mean-res_before_se, mincom, res_before_mean+res_before_se, code=3,
angle=90, length=0.05)
par(new=T)
matplot(mincom, res_before_mean, xlim=c(0,30), ylim=c(0,16),
type="o", col=c(2,1), lty=c(2,1), pch=20 ,ylab="speed (mm/sec)", xlab="time (min)")
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,16))
arrows(mincom, res_after_mean-res_after_se, mincom, res_after_mean+res_after_se, code=3,
angle=90, length=0.05)
par(new=T)
matplot(res_after_mean, xlim=c(0,30), ylim=c(0,16),
type="o", col=c(2,1), lty=c(2,1), pch=20 ,ylab="speed (mm/sec)", xlab="time (min)")
res_before_mean <- tapply(res_before$mean_angle, res_before[,c(5,2)], mean)
res_after_mean <- tapply(res_after$mean_angle, res_after[,c(5,2)], mean)
res_before_se <- tapply(res_before$mean_angle, res_before[,c(5,2)], se)
res_after_se <- tapply(res_after$mean_angle, res_after[,c(5,2)], se)
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,1.5))
arrows(mincom, res_before_mean-res_before_se, mincom, res_before_mean+res_before_se, code=3,
angle=90, length=0.05)
par(new=T)
matplot(mincom, res_before_mean, xlim=c(0,30), ylim=c(0,1.5),
type="o", col=c(2,1), lty=c(2,1), pch=20 ,ylab="angle (rad)", xlab="time (min)")
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,1.5))
arrows(mincom, res_after_mean-res_after_se, mincom, res_after_mean+res_after_se, code=3,
angle=90, length=0.05)
par(new=T)
matplot(res_after_mean, xlim=c(0,30), ylim=c(0,1.5),
type="o", col=c(2,1), lty=c(2,1), pch=20 ,ylab="angle (rad)", xlab="time (min)")
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,1.5))
arrows(mincom, res_before_mean-res_before_se, mincom, res_before_mean+res_before_se, code=3,
angle=90, length=0.05)
par(new=T)
matplot(mincom, res_before_mean, xlim=c(0,30), ylim=c(0,1.5),
type="o", col=c(2,1), lty=c(2,1), pch=20 ,ylab="angle (rad)", xlab="time (min)")
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,1.5))
arrows(mincom, res_after_mean-res_after_se, mincom, res_after_mean+res_after_se, code=3,
angle=90, length=0.05)
par(new=T)
matplot(res_after_mean, xlim=c(0,30), ylim=c(0,1.5),
type="o", col=c(2,1), lty=c(2,1), pch=20 ,ylab="angle (rad)", xlab="time (min)")
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,1.5))
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,1.5))
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,1.5))
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,1.5))
arrows(mincom, res_before_mean-res_before_se, mincom, res_before_mean+res_before_se, code=3,
angle=90, length=0.05)
par(new=T)
matplot(mincom, res_before_mean, xlim=c(0,30), ylim=c(0,1.5),
type="o", col=c(2,1), lty=c(2,1), pch=20 ,ylab="angle (rad)", xlab="time (min)")
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,1.5))
arrows(mincom, res_after_mean-res_after_se, mincom, res_after_mean+res_after_se, code=3,
angle=90, length=0.05)
par(new=T)
matplot(res_after_mean, xlim=c(0,30), ylim=c(0,1.5),
type="o", col=c(2,1), lty=c(2,1), pch=20 ,ylab="angle (rad)", xlab="time (min)")
res_after_se <- tapply(res_after$mean_angle, res_after[,c(5,2)], se)
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,1.5))
arrows(mincom, res_before_mean-res_before_se, mincom, res_before_mean+res_before_se, code=3,
angle=90, length=0.05)
par(new=T)
matplot(mincom, res_before_mean, xlim=c(0,30), ylim=c(0,1.5),
type="o", col=c(2,1), lty=c(2,1), pch=20 ,ylab="angle (rad)", xlab="time (min)")
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,1.5))
arrows(mincom, res_after_mean-res_after_se, mincom, res_after_mean+res_after_se, code=3,
angle=90, length=0.05)
par(new=T)
matplot(res_after_mean, xlim=c(0,30), ylim=c(0,1.5),
type="o", col=c(2,1), lty=c(2,1), pch=20 ,ylab="angle (rad)", xlab="time (min)")
res_before <- res[res$treat=="before",]
res_after <- res[res$treat=="after",]
res_before_mean <- tapply(res_before$mean_speed, res_before[,c(5,2)], mean)
res_after_mean <- tapply(res_after$mean_speed, res_after[,c(5,2)], mean)
res_before_se <- tapply(res_before$mean_speed, res_before[,c(5,2)], se)
res_after_se <- tapply(res_after$mean_speed, res_after[,c(5,2)], se)
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,16))
arrows(mincom, res_before_mean-res_before_se, mincom, res_before_mean+res_before_se, code=3,
angle=90, length=0.05)
par(new=T)
matplot(mincom, res_before_mean, xlim=c(0,30), ylim=c(0,16),
type="o", col=c(2,1), lty=c(2,1), pch=20 ,ylab="speed (mm/sec)", xlab="time (min)")
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,16))
arrows(mincom, res_after_mean-res_after_se, mincom, res_after_mean+res_after_se, code=3,
angle=90, length=0.05)
par(new=T)
matplot(res_after_mean, xlim=c(0,30), ylim=c(0,16),
type="o", col=c(2,1), lty=c(2,1), pch=20 ,ylab="speed (mm/sec)", xlab="time (min)")
res_before_mean <- tapply(res_before$mean_angle, res_before[,c(5,2)], mean)
res_after_mean <- tapply(res_after$mean_angle, res_after[,c(5,2)], mean)
res_before_se <- tapply(res_before$mean_angle, res_before[,c(5,2)], se)
res_after_se <- tapply(res_after$mean_angle, res_after[,c(5,2)], se)
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,1.5))
arrows(mincom, res_before_mean-res_before_se, mincom, res_before_mean+res_before_se, code=3,
angle=90, length=0.05)
par(new=T)
matplot(mincom, res_before_mean, xlim=c(0,30), ylim=c(0,1.5),
type="o", col=c(2,1), lty=c(2,1), pch=20 ,ylab="angle (rad)", xlab="time (min)")
plot(0, ann=F, axes=F, type="n", xlim=c(0,30), ylim=c(0,1.5))
arrows(mincom, res_after_mean-res_after_se, mincom, res_after_mean+res_after_se, code=3,
angle=90, length=0.05)
par(new=T)
matplot(res_after_mean, xlim=c(0,30), ylim=c(0,1.5),
type="o", col=c(2,1), lty=c(2,1), pch=20 ,ylab="angle (rad)", xlab="time (min)")
trajectory_name
## packages
library(data.table)
## function
se  <-  function(x)
{
y  <-  x[!is.na(x)]  #  remove  the  missing  values
sqrt(var(as.vector(y))/length(y))
}
## setting
anal_FPS <- 5
set1X <- 0.38522848
set1Y <- 0.384615385
set2X <- 0.379879487
set2Y <- 0.381679389
set3X <- 0.219663687
set3Y <- 0.219597153
## main
Colony = Sex = ID = Minutes = Treat = Mean_speed = Mean_angle <- NULL
setwd("F:\\tandem\\solo-tandem\\location_data\\raw_data")
Folder.path <- getwd()
f.namesplace <- list.files(Folder.path, pattern=".csv",full.names=T)
for(j in 1:length(f.namesplace)){
data.path <- f.namesplace[j]
#########################
##### data を解析用に修正・保存
########################
d <- data.frame(as.matrix(fread(data.path, header=T)))
## 時間合わせ
# 30FPSのdataを変更
d[,1] <- d[,1]/30
anal_time <- seq(1, 30*30*60+1, 30/anal_FPS)
## scaling
# 満遍なく移動したと想定（max - min = 150mm）
Xmin <- min(na.omit(d$x0)); d$x0 <- d$x0 - Xmin;
Ymin <- min(na.omit(d$y0)); d$y0 <- d$y0 - Ymin;
setpoint <- regexpr("set", data.path)[1]
videoset <- as.numeric(substr(data.path, setpoint+3, setpoint+3))
if(videoset==1){
d$x0 <- d$x0 * set1X; d$y0 <- d$y0 * set1Y;
} else if(videoset==2){
d$x0 <- d$x0 * set2X; d$y0 <- d$y0 * set2Y;
} else {
d$x0 <- d$x0 * set3X; d$y0 <- d$y0 * set3Y;
}
## データ作成, 軌跡保存
da <- d[anal_time,]
L <- length(da[,1])
time <- da[,1]
x <- da[,2]
y <- da[,3]
dis <- ( (x[2:L]-x[2:L-1])^2 + (y[2:L]-y[2:L-1])^2 )^0.5
speed <- dis*5
Ax <- (x[3:L-1] - x[3:L-2])
Bx <- (x[3:L] - x[3:L-1])
Ay <- (y[3:L-1] - y[3:L-2])
By <- (y[3:L] - y[3:L-1])
hugo <- (Ax * By - Ay * Bx + 0.000001)/abs(Ax * By - Ay * Bx + 0.000001)
cos <- (Ax * Bx + Ay * By) / ((Ax^2 + Ay^2)*(Bx^2 + By^2))^0.5
angle <- acos(cos)*hugo
## save
## sex, 0:F, 1:M
datepoint <- regexpr("170", data.path)[1]
id <- (substr(data.path, datepoint, datepoint+13))
date <- (substr(data.path, datepoint, datepoint+5))
if(regexpr("_F_",data.path)>0) { sex <- 0;} else { sex <- 1; }
colony <- (substr(data.path, datepoint+7, datepoint+9))
iter <- (substr(data.path, datepoint+13, datepoint+13))
treat <- (substr(data.path, datepoint+15, datepoint+20))
if(treat=="after-"){treat <- "after"}
trajectory_name <- gsub(".csv",".pdf",data.path)
#pdf(trajectory_name)
par(pin=c(2.2, 2.2), mfrow=c(2,2))
#par(pin=c(5, 5), mfrow=c(1,1))
plot(y0~x0, data=da, type="l",xlim=c(0,145), ylim=c(0,145), xlab="x (mm)", ylab="y (mm)", main=paste(id,treat))
plot(time[2:L], speed, xlab="time (sec)", ylab="speed (mm/sec)", main=paste(id,treat))
plot(time[3:L], abs(angle), xlab="time (sec)", ylab="angle (rad)", main=paste(id,treat))
#dev.off()
output_name <- gsub(".csv","_5FPS.txt",data.path)
output <- data.frame(time = time, x = x, y = y, speed = c(NA,speed), angle = c(NA,NA,angle))
write(output, output_name)
#for(i in seq(1, length(anal_time), 10)){
#  j <- max(1,i-50)
#  plot(y0~x0, data=da[j:i,], type="l", xlim=c(0,150), ylim=c(0,150), main = paste(da[i,1], "sec"))
#  points(y0~x0, data=da[i,], pch=19)
#  Sys.sleep(0.05)
#}
## 1分ごとの平均値
mincom <- seq(1,30,1)
minutes <- c(0, rep(seq(1,30,1), each = 5*60))
mean_speed <- tapply(na.omit(speed), minutes[2:L][!is.nan(speed)&!is.na(speed)], mean)
mean_angle <- tapply(na.omit(abs(angle)), minutes[3:L][!is.nan(angle)&!is.na(angle)], mean)
if(length(mean_angle)<30){mean_angle<-c(mean_angle,rep(NA,30-length(mean_angle)))}
if(length(mean_speed)<30){mean_speed<-c(mean_speed,rep(NA,30-length(mean_speed)))}
Colony <- c(Colony, rep(colony, 30))
Sex <- c(Sex, rep(sex, 30))
ID <- c(ID, rep(paste(date,iter,sep="_"), 30))
Treat <- c(Treat, rep(treat, 30))
Minutes <- c(Minutes, mincom)
Mean_speed <- c(Mean_speed, mean_speed)
Mean_angle <- c(Mean_angle, mean_angle)
}
d <- data.frame(as.matrix(fread(data.path, header=T)))
d[,1] <- d[,1]/30
anal_time <- seq(1, 30*30*60+1, 30/anal_FPS)
Xmin <- min(na.omit(d$x0)); d$x0 <- d$x0 - Xmin;
Ymin <- min(na.omit(d$y0)); d$y0 <- d$y0 - Ymin;
setpoint <- regexpr("set", data.path)[1]
videoset <- as.numeric(substr(data.path, setpoint+3, setpoint+3))
if(videoset==1){
d$x0 <- d$x0 * set1X; d$y0 <- d$y0 * set1Y;
} else if(videoset==2){
d$x0 <- d$x0 * set2X; d$y0 <- d$y0 * set2Y;
} else {
d$x0 <- d$x0 * set3X; d$y0 <- d$y0 * set3Y;
}
da <- d[anal_time,]
L <- length(da[,1])
time <- da[,1]
x <- da[,2]
y <- da[,3]
dis <- ( (x[2:L]-x[2:L-1])^2 + (y[2:L]-y[2:L-1])^2 )^0.5
speed <- dis*5
Ax <- (x[3:L-1] - x[3:L-2])
Bx <- (x[3:L] - x[3:L-1])
Ay <- (y[3:L-1] - y[3:L-2])
By <- (y[3:L] - y[3:L-1])
hugo <- (Ax * By - Ay * Bx + 0.000001)/abs(Ax * By - Ay * Bx + 0.000001)
cos <- (Ax * Bx + Ay * By) / ((Ax^2 + Ay^2)*(Bx^2 + By^2))^0.5
angle <- acos(cos)*hugo
datepoint <- regexpr("170", data.path)[1]
id <- (substr(data.path, datepoint, datepoint+13))
date <- (substr(data.path, datepoint, datepoint+5))
if(regexpr("_F_",data.path)>0) { sex <- 0;} else { sex <- 1; }
colony <- (substr(data.path, datepoint+7, datepoint+9))
iter <- (substr(data.path, datepoint+13, datepoint+13))
treat <- (substr(data.path, datepoint+15, datepoint+20))
if(treat=="after-"){treat <- "after"}
trajectory_name <- gsub(".csv",".pdf",data.path)
par(pin=c(2.2, 2.2), mfrow=c(2,2))
plot(y0~x0, data=da, type="l",xlim=c(0,145), ylim=c(0,145), xlab="x (mm)", ylab="y (mm)", main=paste(id,treat))
plot(time[2:L], speed, xlab="time (sec)", ylab="speed (mm/sec)", main=paste(id,treat))
plot(time[3:L], abs(angle), xlab="time (sec)", ylab="angle (rad)", main=paste(id,treat))
output_name <- gsub(".csv","_5FPS.txt",data.path)
output <- data.frame(time = time, x = x, y = y, speed = c(NA,speed), angle = c(NA,NA,angle))
write(output, output_name)
output
output_name
write.table(output, output_name)
read.table(output_name)
## codes for analysis on separation search
## data from R.speratus
## 170619 N. Mizumoto
## packages
library(data.table)
## function
se  <-  function(x)
{
y  <-  x[!is.na(x)]  #  remove  the  missing  values
sqrt(var(as.vector(y))/length(y))
}
## setting
anal_FPS <- 5
set1X <- 0.38522848
set1Y <- 0.384615385
set2X <- 0.379879487
set2Y <- 0.381679389
set3X <- 0.219663687
set3Y <- 0.219597153
## main
Colony = Sex = ID = Minutes = Treat = Mean_speed = Mean_angle <- NULL
setwd("F:\\tandem\\solo-tandem\\location_data\\raw_data")
Folder.path <- getwd()
f.namesplace <- list.files(Folder.path, pattern=".csv",full.names=T)
for(j in 1:length(f.namesplace)){
data.path <- f.namesplace[j]
#########################
##### data を解析用に修正・保存
########################
d <- data.frame(as.matrix(fread(data.path, header=T)))
## 時間合わせ
# 30FPSのdataを変更
d[,1] <- d[,1]/30
anal_time <- seq(1, 30*30*60+1, 30/anal_FPS)
## scaling
# 満遍なく移動したと想定（max - min = 150mm）
Xmin <- min(na.omit(d$x0)); d$x0 <- d$x0 - Xmin;
Ymin <- min(na.omit(d$y0)); d$y0 <- d$y0 - Ymin;
setpoint <- regexpr("set", data.path)[1]
videoset <- as.numeric(substr(data.path, setpoint+3, setpoint+3))
if(videoset==1){
d$x0 <- d$x0 * set1X; d$y0 <- d$y0 * set1Y;
} else if(videoset==2){
d$x0 <- d$x0 * set2X; d$y0 <- d$y0 * set2Y;
} else {
d$x0 <- d$x0 * set3X; d$y0 <- d$y0 * set3Y;
}
## データ作成, 軌跡保存
da <- d[anal_time,]
L <- length(da[,1])
time <- da[,1]
x <- da[,2]
y <- da[,3]
dis <- ( (x[2:L]-x[2:L-1])^2 + (y[2:L]-y[2:L-1])^2 )^0.5
speed <- dis*5
Ax <- (x[3:L-1] - x[3:L-2])
Bx <- (x[3:L] - x[3:L-1])
Ay <- (y[3:L-1] - y[3:L-2])
By <- (y[3:L] - y[3:L-1])
hugo <- (Ax * By - Ay * Bx + 0.000001)/abs(Ax * By - Ay * Bx + 0.000001)
cos <- (Ax * Bx + Ay * By) / ((Ax^2 + Ay^2)*(Bx^2 + By^2))^0.5
angle <- acos(cos)*hugo
## save
## sex, 0:F, 1:M
datepoint <- regexpr("170", data.path)[1]
id <- (substr(data.path, datepoint, datepoint+13))
date <- (substr(data.path, datepoint, datepoint+5))
if(regexpr("_F_",data.path)>0) { sex <- 0;} else { sex <- 1; }
colony <- (substr(data.path, datepoint+7, datepoint+9))
iter <- (substr(data.path, datepoint+13, datepoint+13))
treat <- (substr(data.path, datepoint+15, datepoint+20))
if(treat=="after-"){treat <- "after"}
trajectory_name <- gsub(".csv",".pdf",data.path)
#pdf(trajectory_name)
par(pin=c(2.2, 2.2), mfrow=c(2,2))
#par(pin=c(5, 5), mfrow=c(1,1))
plot(y0~x0, data=da, type="l",xlim=c(0,145), ylim=c(0,145), xlab="x (mm)", ylab="y (mm)", main=paste(id,treat))
plot(time[2:L], speed, xlab="time (sec)", ylab="speed (mm/sec)", main=paste(id,treat))
plot(time[3:L], abs(angle), xlab="time (sec)", ylab="angle (rad)", main=paste(id,treat))
#dev.off()
output_name <- gsub(".csv","_5FPS.txt",data.path)
output <- data.frame(time = time, x = x, y = y, speed = c(NA,speed), angle = c(NA,NA,angle))
write.table(output, output_name)
#for(i in seq(1, length(anal_time), 10)){
#  j <- max(1,i-50)
#  plot(y0~x0, data=da[j:i,], type="l", xlim=c(0,150), ylim=c(0,150), main = paste(da[i,1], "sec"))
#  points(y0~x0, data=da[i,], pch=19)
#  Sys.sleep(0.05)
#}
## 1分ごとの平均値
mincom <- seq(1,30,1)
minutes <- c(0, rep(seq(1,30,1), each = 5*60))
mean_speed <- tapply(na.omit(speed), minutes[2:L][!is.nan(speed)&!is.na(speed)], mean)
mean_angle <- tapply(na.omit(abs(angle)), minutes[3:L][!is.nan(angle)&!is.na(angle)], mean)
if(length(mean_angle)<30){mean_angle<-c(mean_angle,rep(NA,30-length(mean_angle)))}
if(length(mean_speed)<30){mean_speed<-c(mean_speed,rep(NA,30-length(mean_speed)))}
Colony <- c(Colony, rep(colony, 30))
Sex <- c(Sex, rep(sex, 30))
ID <- c(ID, rep(paste(date,iter,sep="_"), 30))
Treat <- c(Treat, rep(treat, 30))
Minutes <- c(Minutes, mincom)
Mean_speed <- c(Mean_speed, mean_speed)
Mean_angle <- c(Mean_angle, mean_angle)
}
setwd("F:\\tandem\\solo-tandem\\location_data\\raw_data")
setwd("F:\\tandem\\solo-tandem\\location_data\\rawdata_tandem")
Folder.path <- getwd()
f.namesplace <- list.files(Folder.path, pattern=".csv",full.names=T)
f.namesplace
j
j<-1
- f.namesplace[j]
data.path <- f.namesplace[j]
data.path
d <- data.frame(as.matrix(fread(data.path, header=T)))
d[,1] <- d[,1]/30
anal_time <- seq(1, 30*30*60+1, 30/anal_FPS)
head(d)
plot(y0~x0,data=d,col=2)
plot(y0~x0,data=d,col=2, type="l")
d
plot(y0~x0,data=d,col=2, type="l")
plot(1)
plot(y0~x0,data=d,col=2, type="l")
datepoint <- regexpr("170", data.path)[1]
id <- (substr(data.path, datepoint, datepoint+13))
date <- (substr(data.path, datepoint, datepoint+5))
if(regexpr("_F_",data.path)>0) { sex <- 0;} else { sex <- 1; }
colony <- (substr(data.path, datepoint+7, datepoint+9))
iter <- (substr(data.path, datepoint+13, datepoint+13))
treat <- (substr(data.path, datepoint+15, datepoint+20))
if(treat=="after-"){treat <- "after"}
id
date
sex
colony
iter
treat
if(sex == 0){
x <- d$x0; y <- d$y0;
} else {
x <- d$x1; y <- d$y1;
}
x
y
Xmin <- min(na.omit(x)); x <- x - Xmin;
Ymin <- min(na.omit(y)); y <- y - Ymin;
x
y
setpoint <- regexpr("set", data.path)[1]
videoset <- as.numeric(substr(data.path, setpoint+3, setpoint+3))
if(videoset==1){
d$x0 <- d$x0 * set1X; d$y0 <- d$y0 * set1Y;
} else if(videoset==2){
d$x0 <- d$x0 * set2X; d$y0 <- d$y0 * set2Y;
} else {
d$x0 <- d$x0 * set3X; d$y0 <- d$y0 * set3Y;
}
if(videoset==1){
x <- x * set1X; y <- y * set1Y;
} else if(videoset==2){
x <- x * set2X; y <- y * set2Y;
} else {
x <- x * set3X; y <- y * set3Y;
}
x
y
time <- d[anal_time,1]
time <- d[anal_time,1]
dis <- ( (x[2:L]-x[2:L-1])^2 + (y[2:L]-y[2:L-1])^2 )^0.5
speed <- dis*5
Ax <- (x[3:L-1] - x[3:L-2])
Bx <- (x[3:L] - x[3:L-1])
Ay <- (y[3:L-1] - y[3:L-2])
By <- (y[3:L] - y[3:L-1])
hugo <- (Ax * By - Ay * Bx + 0.000001)/abs(Ax * By - Ay * Bx + 0.000001)
cos <- (Ax * Bx + Ay * By) / ((Ax^2 + Ay^2)*(Bx^2 + By^2))^0.5
angle <- acos(cos)*hugo
